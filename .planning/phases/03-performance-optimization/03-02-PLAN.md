---
phase: 03-performance-optimization
type: execute
---

<objective>
Vite 번들 최적화 및 코드 스플리팅 개선

목적: 남은 vendor 번들 크기 감소, 청크 분할 최적화, 트리 셰이킹 개선
결과물: 최적화된 vite.config.ts, 감소된 vendor 번들, 개선된 초기 로딩 속도
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-performance-optimization/03-01-SUMMARY.md
@vite.config.ts
@.planning/codebase/STACK.md

**Plan 03-01 완료:**
- HeroSection Three.js 제거 (1.2M 감소)
- Canvas3D lazy loading 적용

**현재 번들 상태 (03-01 이후 예상):**
```
vendor-motion: 118K (Framer Motion)
vendor-router: 35K (React Router)
vendor-react: 12K (React)
HomePage: ~15-20K
ExperiencePage: 60K
```

**최적화 목표:**
- vendor-motion 크기 감소 (tree-shaking)
- 페이지 컴포넌트 lazy loading 개선
- 불필요한 코드 제거
- Vite 빌드 설정 최적화
</context>

<tasks>

<task type="auto">
  <name>Task 1: Framer Motion tree-shaking 최적화</name>
  <files>components/hero/HeroSection.tsx, components/VoiceExperience.tsx, 기타 motion 사용 파일</files>
  <action>Framer Motion 번들 크기를 줄이기 위해 필요한 기능만 import:

**1. 현재 import 패턴 확인:**
```tsx
import { motion } from 'framer-motion';
```

**2. 최적화 방법 (필요 시 적용):**

Framer Motion은 이미 tree-shaking이 잘 되어 있으므로, 현재 import 방식 유지.
대신 불필요한 기능 사용 제거:

- AnimatePresence를 사용하지 않는다면 import 제거
- MotionConfig, LazyMotion 등 고급 기능 사용 안 함 확인

**3. 각 파일에서 확인할 사항:**

a. HeroSection.tsx:
   - motion.div, motion.h1, motion.p만 사용
   - animate, transition, initial props만 사용
   - 복잡한 variants 대신 inline animations 사용 (이미 적용됨)

b. VoiceExperience.tsx:
   - motion 사용 확인
   - 불필요한 animate props 제거

c. 기타 컴포넌트:
   - InteractiveDemo, Estimator 등에서 motion 사용 확인

**4. production 빌드에서 자동 tree-shaking 활성화:**
- Vite는 기본적으로 tree-shaking 지원
- 추가 설정 불필요

**주의사항:**
- motion import는 그대로 유지 (이미 최적화됨)
- 불필요한 애니메이션 복잡도 제거만 수행
- 시각적 품질 저하 없도록
</action>
  <verify>npm run build 후 vendor-motion 크기 확인, 기능 정상 작동</verify>
  <done>Framer Motion 최적화 확인, 불필요한 코드 제거</done>
</task>

<task type="auto">
  <name>Task 2: 대형 컴포넌트 lazy loading 확장</name>
  <files>pages/ExperiencePage.tsx, components/room-planner/RoomPlanner.tsx</files>
  <action>큰 컴포넌트들을 lazy loading으로 전환하여 초기 로딩 속도 개선:

**1. ExperiencePage 내부 확인:**

ExperiencePage.tsx 파일을 읽고 구조 확인:
- VoiceExperience 컴포넌트 사용 확인
- RoomPlanner 컴포넌트 사용 확인

**2. 큰 컴포넌트 lazy loading:**

ExperiencePage가 60K로 큰 경우, 내부 컴포넌트를 lazy load:

```tsx
import React, { lazy, Suspense } from 'react';
import LoadingSpinner from '../components/LoadingSpinner';

const RoomPlanner = lazy(() => import('../components/room-planner/RoomPlanner'));
const VoiceExperience = lazy(() => import('../components/VoiceExperience'));

const ExperiencePage: React.FC = () => {
  return (
    <div>
      <Suspense fallback={<LoadingSpinner size="lg" fullScreen />}>
        <RoomPlanner />
      </Suspense>

      <Suspense fallback={<LoadingSpinner size="lg" fullScreen />}>
        <VoiceExperience />
      </Suspense>
    </div>
  );
};
```

**3. RoomPlanner 확인:**

RoomPlanner가 여러 서브 컴포넌트를 포함하는 경우:
- 내부 컴포넌트는 일반 import 유지 (너무 많은 lazy loading은 오버헤드)
- RoomPlanner 전체를 lazy load하는 것으로 충분

**주의사항:**
- 각 Suspense는 독립적인 fallback 제공
- LoadingSpinner를 사용하여 일관된 로딩 UI
- ExperiencePage가 이미 lazy loaded이므로 2단계 lazy loading
</action>
  <verify>ExperiencePage 접속 시 컴포넌트가 순차적으로 로드됨, 로딩 스피너 표시</verify>
  <done>대형 컴포넌트 lazy loading 적용, 초기 번들 크기 감소</done>
</task>

<task type="auto">
  <name>Task 3: vite.config.ts 빌드 최적화</name>
  <files>vite.config.ts</files>
  <action>Vite 빌드 설정을 최적화하여 번들 크기 및 로딩 속도 개선:

**1. 현재 설정 확인 (vite.config.ts 25-43번 줄):**
- manualChunks 이미 설정됨 (vendor 분리)
- chunkSizeWarningLimit: 500

**2. 추가 최적화 설정:**

build 섹션에 다음 추가:

```typescript
build: {
  rollupOptions: {
    output: {
      manualChunks: {
        // 기존 설정 유지
        'vendor-react': ['react', 'react-dom'],
        'vendor-router': ['react-router-dom'],
        'vendor-three': ['three', '@react-three/fiber', '@react-three/drei'],
        'vendor-motion': ['framer-motion'],
        'vendor-ai': ['@google/genai'],
      },
    },
  },
  chunkSizeWarningLimit: 500,
  // 추가 최적화
  minify: 'terser',  // terser 사용 (기본값이지만 명시)
  terserOptions: {
    compress: {
      drop_console: true,  // production에서 console.log 제거
      drop_debugger: true,
    },
  },
  // CSS 코드 스플리팅
  cssCodeSplit: true,
  // Source map 비활성화 (production)
  sourcemap: false,
},
```

**3. CSS 최적화:**

CSS 코드 스플리팅이 활성화되어 각 청크마다 별도 CSS 파일 생성.

**주의사항:**
- drop_console은 production 빌드에만 적용 (개발 시 console 유지)
- sourcemap: false로 번들 크기 감소 (디버깅 필요 시 true로 변경 가능)
- terser minify는 느리지만 더 작은 번들 생성
</action>
  <verify>npm run build 후 dist/assets 크기 확인, console.log가 production 번들에 없음</verify>
  <done>vite.config.ts 최적화 완료, 번들 크기 감소</done>
</task>

<task type="auto">
  <name>Task 4: 빌드 크기 측정 및 비교</name>
  <files>없음 (측정만)</files>
  <action>최적화 전후 번들 크기를 측정하고 비교:

**1. 빌드 및 측정:**

```bash
npm run build
```

**2. 번들 크기 확인:**

dist/assets 폴더의 파일 크기 확인:
```bash
ls -lh dist/assets/*.js
```

**3. 비교 분석:**

**최적화 전 (Plan 03-01 이전):**
```
vendor-three: 1.2M
vendor-motion: 118K
HomePage: 35K
ExperiencePage: 60K
총합: ~1.4M+
```

**최적화 후 (Plan 03-02 완료 후 예상):**
```
HomePage: 15-20K (Three.js 제거)
ExperiencePage: lazy loaded chunks
vendor-motion: ~100K (tree-shaking)
vendor-three: lazy loaded (초기 번들 제외)
총 초기 번들: ~200-250K
```

**4. 개선율 계산:**
- 초기 번들: ~1.4M → ~250K (약 82% 감소)

**주의사항:**
- gzip 압축 후 크기도 고려
- 실제 네트워크 전송 크기 측정
- 각 페이지별 로딩 시간 측정
</action>
  <verify>총 초기 번들 크기 70% 이상 감소, 측정 데이터 기록</verify>
  <done>번들 크기 측정 완료, 개선율 확인, 데이터 기록</done>
</task>

</tasks>

<verification>
완료 전 확인사항:
- [ ] npm test 모든 테스트 통과
- [ ] npm run build 성공
- [ ] vendor-motion 크기 유지 또는 감소
- [ ] ExperiencePage 컴포넌트 lazy loading 작동
- [ ] production 빌드에 console.log 없음
- [ ] 총 초기 번들 크기 70% 이상 감소
- [ ] 모든 페이지 정상 작동
</verification>

<success_criteria>

- Framer Motion tree-shaking 확인 및 최적화
- RoomPlanner, VoiceExperience lazy loading 적용
- vite.config.ts 빌드 최적화 (terser, drop_console)
- 번들 크기 측정 및 비교 데이터 기록
- 초기 번들 크기 70% 이상 감소
- 모든 기능 정상 작동
  </success_criteria>

<output>
완료 후 `.planning/phases/03-performance-optimization/03-02-SUMMARY.md` 생성:

# Phase 3 Plan 2: 번들 최적화 및 코드 스플리팅 요약

**Vite 설정 최적화로 초기 번들 70% 이상 감소**

## 달성 사항

- Framer Motion tree-shaking 확인 및 최적화
- ExperiencePage 내부 컴포넌트 lazy loading (RoomPlanner, VoiceExperience)
- vite.config.ts 빌드 최적화 (terser, drop_console, cssCodeSplit)
- 번들 크기 측정 및 비교 분석

## 생성/수정 파일

- `pages/ExperiencePage.tsx` - lazy loading 적용
- `vite.config.ts` - terser 최적화, console 제거
- 기타 Framer Motion 사용 파일 검토

## 결정 사항

- Framer Motion: 현재 import 방식 유지 (이미 최적화됨)
- Lazy loading: 대형 컴포넌트 (RoomPlanner, VoiceExperience)
- Terser minify: drop_console, drop_debugger 활성화
- Source map: production에서 비활성화

## 성능 개선

**번들 크기 (초기 로딩):**
- 최적화 전: ~1.4M+
- 최적화 후: ~200-250K
- 감소율: 약 82%

**개별 번들:**
- HomePage: 35K → 15-20K
- vendor-three: 1.2M → lazy loaded (초기 제외)
- vendor-motion: 118K → ~100K
- ExperiencePage: 60K → lazy loaded chunks

**Gzip 압축 후:**
- [실제 측정값 기록]

## 발생한 이슈

[이슈가 있었다면 기록, 없으면 "없음"]

## 다음 단계 준비

Plan 03-03로 진행:
- 이미지 최적화 (WebP 변환, lazy loading)
- Lighthouse 성능 측정 및 90+ 달성
- Core Web Vitals 개선
</output>
