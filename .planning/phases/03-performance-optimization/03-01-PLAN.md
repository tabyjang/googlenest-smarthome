---
phase: 03-performance-optimization
type: execute
---

<objective>
히어로 섹션 3D 경량화 및 CSS 기반 대안으로 교체

목적: 1.2MB Three.js 번들을 제거하고 순수 CSS/Framer Motion으로 시각적 품질 유지
결과물: 경량 히어로 섹션, Three.js 제거, 초기 로딩 속도 개선
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-error-handling/02-02-SUMMARY.md
@components/hero/HeroSection.tsx
@.planning/codebase/CONVENTIONS.md

**사용자 피드백:**
"참고로, 히어로 섹션의 움직이는 3D는 너무 무거워서 다른 걸로 교체할 예정이야"

**현재 문제점:**
- vendor-three.js 번들: 1.2MB (가장 큰 번들)
- HeroSection: MeshTransmissionMaterial (GPU 집약적 shader)
- 12개의 Float 애니메이션 (지속적인 리렌더링)
- sphereGeometry 64x64 segments (과도한 폴리곤)
- Environment preset="apartment" (큰 HDR 텍스처)
- autoRotate OrbitControls (매 프레임 리렌더링)

**번들 크기 분석:**
```
vendor-three: 1.2M  ← 가장 큰 문제
vendor-motion: 118K
HomePage: 35K
ExperiencePage: 60K
vendor-router: 35K
```

**프로젝트 디자인 시스템:**
- 컬러: cream (배경), charcoal (텍스트), gold (강조)
- 스타일: rounded-3xl, shadow-luxury, backdrop-blur
- 애니메이션: Framer Motion (이미 사용 중)
</context>

<tasks>

<task type="auto">
  <name>Task 1: CSS 기반 럭셔리 배경 구현</name>
  <files>components/hero/HeroSection.tsx</files>
  <action>Three.js를 제거하고 순수 CSS + Framer Motion으로 럭셔리 배경 재구현:

**1. Three.js 관련 import 모두 제거:**
```tsx
// 삭제할 import
import { Canvas } from '@react-three/fiber';
import { OrbitControls, Environment, Float, MeshTransmissionMaterial } from '@react-three/drei';
```

**2. LuxuryBackground 컴포넌트를 CSS로 재작성:**

삭제: 기존 LuxuryBackground (12-91번 줄)

추가: CSS 기반 애니메이션 배경
```tsx
const LuxuryBackground: React.FC = () => {
  return (
    <div className="absolute inset-0 overflow-hidden">
      {/* Gradient layers */}
      <div className="absolute inset-0 bg-gradient-to-br from-cream-100 via-cream-200 to-cream-300" />
      <div className="absolute inset-0 bg-gradient-to-tl from-gold-100/20 via-transparent to-cream-100/40" />

      {/* Animated orbs - 큰 구체들 */}
      <motion.div
        className="absolute -left-32 top-1/4 w-96 h-96 rounded-full bg-gradient-to-br from-gold-200/30 to-cream-300/40 blur-3xl"
        animate={{
          x: [0, 40, 0],
          y: [0, -30, 0],
          scale: [1, 1.1, 1],
        }}
        transition={{
          duration: 8,
          repeat: Infinity,
          ease: "easeInOut",
        }}
      />

      <motion.div
        className="absolute -right-32 top-1/3 w-80 h-80 rounded-full bg-gradient-to-br from-cream-300/40 to-gold-100/30 blur-3xl"
        animate={{
          x: [0, -30, 0],
          y: [0, 40, 0],
          scale: [1, 1.15, 1],
        }}
        transition={{
          duration: 10,
          repeat: Infinity,
          ease: "easeInOut",
        }}
      />

      <motion.div
        className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[32rem] h-[32rem] rounded-full bg-gradient-to-br from-gold-300/20 to-transparent blur-3xl"
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{
          duration: 12,
          repeat: Infinity,
          ease: "easeInOut",
        }}
      />

      {/* Floating particles - 작은 점들 */}
      {[...Array(6)].map((_, i) => (
        <motion.div
          key={i}
          className="absolute w-2 h-2 rounded-full bg-gold-400/40"
          style={{
            left: `${20 + i * 15}%`,
            top: `${30 + (i % 3) * 20}%`,
          }}
          animate={{
            y: [0, -20, 0],
            opacity: [0.2, 0.6, 0.2],
          }}
          transition={{
            duration: 3 + i * 0.5,
            repeat: Infinity,
            ease: "easeInOut",
            delay: i * 0.2,
          }}
        />
      ))}

      {/* Gold ring accent */}
      <motion.div
        className="absolute left-1/4 top-1/4 w-32 h-32 border-2 border-gold-400/30 rounded-full"
        animate={{
          rotate: 360,
          scale: [1, 1.1, 1],
        }}
        transition={{
          rotate: { duration: 20, repeat: Infinity, ease: "linear" },
          scale: { duration: 8, repeat: Infinity, ease: "easeInOut" },
        }}
      />

      {/* Subtle mesh pattern overlay */}
      <div className="absolute inset-0 opacity-[0.03]"
        style={{
          backgroundImage: `radial-gradient(circle at 2px 2px, currentColor 1px, transparent 0)`,
          backgroundSize: '32px 32px',
        }}
      />
    </div>
  );
};
```

**3. HeroSection render 부분 수정 (100-107번 줄):**

기존:
```tsx
<div className="absolute inset-0">
  <Canvas camera={{ position: [0, 0, 6], fov: 45 }}>
    <Suspense fallback={null}>
      <LuxuryBackground />
    </Suspense>
  </Canvas>
</div>
```

새로운 코드:
```tsx
<LuxuryBackground />
```

**4. Suspense import 제거:**
- Canvas를 사용하지 않으므로 Suspense도 불필요

**주의사항:**
- 기존 텍스트 콘텐츠와 gradient overlays는 모두 유지
- 디자인 시스템 (cream, gold, charcoal) 일관성 유지
- Framer Motion animate는 GPU 가속 사용 (transform, opacity만)
- blur-3xl은 backdrop-filter 사용 (성능 고려)
</action>
  <verify>npm run dev 실행, 히어로 섹션 시각적 품질 확인, 부드러운 애니메이션 작동</verify>
  <done>HeroSection.tsx에서 Three.js 제거, CSS 기반 럭셔리 배경 구현, 시각적 품질 유지</done>
</task>

<task type="auto">
  <name>Task 2: Canvas3D 컴포넌트 lazy loading 적용</name>
  <files>pages/ProductDetailPage.tsx</files>
  <action>ProductDetailPage에서만 사용하는 Canvas3D를 lazy load하여 불필요한 Three.js 로딩 방지:

**1. ProductDetailPage.tsx 수정:**

현재 상태 확인:
- Canvas3D를 import하고 있는지 확인
- 사용 위치 파악

수정 방법:
```tsx
import React, { lazy, Suspense } from 'react';
// 다른 imports...

// Canvas3D를 lazy load
const Canvas3D = lazy(() => import('../components/three/Canvas3D'));

// ProductDetailPage 컴포넌트 내부에서 사용 시:
<Suspense fallback={<LoadingSpinner size="lg" text="3D 모델 로딩 중..." fullScreen />}>
  <Canvas3D productId={productId} />
</Suspense>
```

**2. LoadingSpinner import 추가:**
```tsx
import LoadingSpinner from '../components/LoadingSpinner';
```

**주의사항:**
- Canvas3D는 ProductDetailPage에서만 사용 (다른 페이지에서는 사용 안 함)
- HeroSection에서 Three.js를 제거했으므로 HomePage에서는 Three.js 불필요
- lazy loading으로 ProductDetailPage 접근 시에만 Three.js 로드
</action>
  <verify>HomePage 접속 시 vendor-three.js 로드되지 않음, ProductDetailPage 접속 시에만 로드됨</verify>
  <done>Canvas3D lazy loading 적용, 초기 번들에서 Three.js 제외</done>
</task>

<task type="auto">
  <name>Task 3: 불필요한 Three.js imports 정리 및 테스트</name>
  <files>components/hero/HeroSection.test.tsx (신규 생성)</files>
  <action>1. 전체 프로젝트에서 불필요한 Three.js imports 확인 및 정리:

**검색 및 확인:**
- HomePage.tsx에서 Three.js 관련 import 없는지 확인
- 다른 컴포넌트에서 불필요한 @react-three/* import 확인

**2. HeroSection 테스트 작성 (components/hero/HeroSection.test.tsx):**

```tsx
import { describe, it, expect } from 'vitest';
import { render, screen } from '@testing-library/react';
import { MemoryRouter } from 'react-router-dom';
import HeroSection from './HeroSection';

describe('HeroSection', () => {
  it('메인 헤드라인을 렌더링한다', () => {
    render(
      <MemoryRouter>
        <HeroSection scrollY={0} />
      </MemoryRouter>
    );

    expect(screen.getByText('당신의 공간에')).toBeInTheDocument();
    expect(screen.getByText(/품격/)).toBeInTheDocument();
  });

  it('CTA 버튼들을 렌더링한다', () => {
    render(
      <MemoryRouter>
        <HeroSection scrollY={0} />
      </MemoryRouter>
    );

    expect(screen.getByRole('link', { name: /컬렉션 보기/ })).toBeInTheDocument();
    expect(screen.getByRole('link', { name: /체험하기/ })).toBeInTheDocument();
  });

  it('scrollY에 따라 opacity가 변경된다', () => {
    const { container } = render(
      <MemoryRouter>
        <HeroSection scrollY={250} />
      </MemoryRouter>
    );

    // opacity 계산: Math.max(0, 1 - 250 / 500) = 0.5
    const contentDiv = container.querySelector('.relative.z-10');
    expect(contentDiv).toHaveStyle({ opacity: 0.5 });
  });

  it('Three.js Canvas를 렌더링하지 않는다 (경량화)', () => {
    const { container } = render(
      <MemoryRouter>
        <HeroSection scrollY={0} />
      </MemoryRouter>
    );

    // Canvas 요소가 없어야 함
    expect(container.querySelector('canvas')).toBeNull();
  });
});
```

**주의사항:**
- 마지막 테스트로 Canvas가 렌더링되지 않음을 검증
- 기존 테스트 패턴 (MemoryRouter, RTL 쿼리) 유지
</action>
  <verify>npm test 통과, HeroSection에 canvas 요소 없음 확인</verify>
  <done>불필요한 imports 정리, HeroSection 테스트 4개 작성 및 통과</done>
</task>

<task type="auto">
  <name>Task 4: 빌드 크기 검증 및 성능 측정</name>
  <files>없음 (빌드 및 측정만)</files>
  <action>1. 프로젝트 빌드 및 번들 크기 확인:

```bash
npm run build
```

2. 번들 크기 비교:

**변경 전:**
```
vendor-three: 1.2M
HomePage: 35K
```

**변경 후 예상:**
```
HomePage: ~15-20K (Three.js 제거로 50% 감소)
vendor-three: lazy loaded (초기 로드 제외)
```

3. 개발 서버에서 확인:
```bash
npm run dev
```

- HomePage 접속 → Network 탭에서 vendor-three.js 로드 안 됨 확인
- ProductDetailPage 접속 → vendor-three.js 로드됨 확인

**측정 항목:**
- Initial bundle size 감소량
- HomePage 초기 로딩 속도
- 애니메이션 부드러움 (60fps 유지)

**주의사항:**
- dist/assets/ 폴더에서 실제 파일 크기 확인
- gzip 압축 후 크기도 고려
- Chrome DevTools Performance 탭으로 렌더링 성능 확인
</action>
  <verify>vendor-three.js가 초기 로드에서 제외됨, HomePage 번들 50% 감소, 애니메이션 부드러움</verify>
  <done>빌드 성공, 번들 크기 검증 완료, 성능 개선 확인</done>
</task>

</tasks>

<verification>
완료 전 확인사항:
- [ ] npm test 모든 테스트 통과 (HeroSection 포함)
- [ ] npm run build 성공
- [ ] HomePage에서 vendor-three.js 로드 안 됨
- [ ] ProductDetailPage에서만 vendor-three.js 로드됨
- [ ] HeroSection 시각적 품질 유지 (럭셔리 느낌)
- [ ] 애니메이션 부드러움 (60fps)
- [ ] HomePage 번들 크기 50% 이상 감소
</verification>

<success_criteria>

- HeroSection에서 Three.js 완전 제거
- CSS + Framer Motion 기반 럭셔리 배경 구현
- Canvas3D lazy loading 적용
- HeroSection 테스트 4개 작성 및 통과
- vendor-three.js 초기 번들에서 제외
- HomePage 번들 크기 50% 이상 감소
- 시각적 품질 유지 (디자인 시스템 일관성)
  </success_criteria>

<output>
완료 후 `.planning/phases/03-performance-optimization/03-01-SUMMARY.md` 생성:

# Phase 3 Plan 1: 히어로 섹션 3D 경량화 요약

**Three.js 제거 및 CSS 기반 대안으로 1.2MB 번들 감소**

## 달성 사항

- HeroSection에서 Three.js 완전 제거 (MeshTransmissionMaterial, Float 등)
- CSS gradient + Framer Motion으로 럭셔리 배경 재구현
- Canvas3D lazy loading 적용 (ProductDetailPage만 로드)
- HeroSection 테스트 4개 추가
- vendor-three.js 초기 번들에서 제외

## 생성/수정 파일

- `components/hero/HeroSection.tsx` - Three.js 제거, CSS 재구현
- `pages/ProductDetailPage.tsx` - Canvas3D lazy loading
- `components/hero/HeroSection.test.tsx` - 생성 (4개 테스트)

## 결정 사항

- Three.js 대안: CSS gradient + Framer Motion 애니메이션
- Canvas3D lazy loading: ProductDetailPage에서만 로드
- 애니메이션: GPU 가속 속성만 사용 (transform, opacity)
- 시각적 일관성: 기존 디자인 시스템 유지

## 성능 개선

**번들 크기:**
- HomePage: 35K → ~15-20K (약 50% 감소)
- vendor-three: 1.2M → lazy loaded (초기 로드 제외)

**로딩 속도:**
- 초기 번들 크기: ~1.2MB 감소
- HomePage 로딩: [측정값] 개선

## 구현 세부사항

### CSS 럭셔리 배경
- 3개의 큰 gradient orbs (blur-3xl)
- 6개의 작은 floating particles
- 1개의 회전하는 gold ring
- 미세한 mesh pattern overlay
- Framer Motion으로 부드러운 애니메이션

### Lazy Loading
- Canvas3D를 lazy(() => import(...))로 변경
- Suspense + LoadingSpinner로 폴백 UI
- ProductDetailPage 접속 시에만 Three.js 로드

### 테스트
- 헤드라인 렌더링 테스트
- CTA 버튼 테스트
- scrollY에 따른 opacity 변화 테스트
- Canvas 미렌더링 검증 테스트

## 발생한 이슈

[이슈가 있었다면 기록, 없으면 "없음"]

## 다음 단계 준비

Plan 03-02로 진행:
- Vite 번들 최적화 및 코드 스플리팅
- 컴포넌트 lazy loading 확장
- Tree-shaking 개선
</output>
