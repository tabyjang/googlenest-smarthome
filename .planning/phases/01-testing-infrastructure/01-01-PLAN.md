---
phase: 01-testing-infrastructure
type: execute
---

<objective>
Set up Vitest test framework with React Testing Library for the Google Nest project.

Purpose: Establish testing infrastructure as foundation for all quality assurance work in subsequent phases.
Output: Configured Vitest + React Testing Library, ready to write and run tests.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/TESTING.md
@.planning/codebase/STACK.md
@.planning/codebase/CONVENTIONS.md
@package.json
@vite.config.ts
@tsconfig.json

**Current State:**
- No test framework configured (TESTING.md confirms zero tests)
- React 19.2.3 + TypeScript 5.8.2 + Vite 6.2.0
- Existing @vitejs/plugin-react in vite.config.ts
- Project uses PascalCase.tsx for components, camelCase functions

**Discovery Results:**
- Vitest is Vite-native test runner (optimal for this stack)
- React Testing Library for component testing
- jsdom for DOM environment
- @testing-library/jest-dom for extended matchers
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install test dependencies</name>
  <files>package.json, package-lock.json</files>
  <action>Install Vitest testing stack with npm:

```bash
npm install --save-dev vitest @testing-library/react @testing-library/jest-dom @testing-library/user-event jsdom @vitest/ui
```

Dependencies explained:
- vitest: Test runner (Vite-native, fast)
- @testing-library/react: React component testing utilities
- @testing-library/jest-dom: Extended DOM matchers (toBeInTheDocument, etc.)
- @testing-library/user-event: Simulate user interactions
- jsdom: DOM environment for tests (lighter than happy-dom for React)
- @vitest/ui: Optional test UI for better DX

Do NOT use Jest or other test runners (Vitest is Vite-native and faster).
  </action>
  <verify>npm list vitest @testing-library/react shows all packages installed</verify>
  <done>All 6 packages added to devDependencies in package.json</done>
</task>

<task type="auto">
  <name>Task 2: Configure Vitest in vite.config.ts</name>
  <files>vite.config.ts</files>
  <action>Add Vitest configuration to existing vite.config.ts:

1. Add triple-slash reference at top:
```typescript
/// <reference types="vitest/config" />
```

2. Add `test` section to defineConfig return object:
```typescript
test: {
  globals: true,
  environment: 'jsdom',
  setupFiles: './vitest-setup.ts',
  css: true,
}
```

Configuration explained:
- `globals: true` - No need to import describe/it/expect in every test
- `environment: 'jsdom'` - DOM environment for React component tests
- `setupFiles` - Load jest-dom matchers before tests
- `css: true` - Process CSS imports (Tailwind in this project)

Do NOT change existing server/plugins/build config.
  </action>
  <verify>File contains /// reference and test section, build still works (npm run build)</verify>
  <done>vite.config.ts has Vitest config, no TypeScript errors</done>
</task>

<task type="auto">
  <name>Task 3: Create Vitest setup file and update tsconfig</name>
  <files>vitest-setup.ts, tsconfig.json</files>
  <action>1. Create `vitest-setup.ts` at project root:
```typescript
import '@testing-library/jest-dom/vitest';
```

This imports extended matchers (toBeInTheDocument, toHaveTextContent, etc.).

2. Add Vitest types to `tsconfig.json` compilerOptions.types array:
```json
"types": ["vitest/globals", "vitest/jsdom"]
```

If types array doesn't exist, create it. This enables TypeScript to recognize:
- vitest/globals: describe, it, expect without imports
- vitest/jsdom: DOM types (document, window, etc.)
  </action>
  <verify>vitest-setup.ts exists, tsconfig.json has types array with both entries</verify>
  <done>Setup file created, TypeScript recognizes test globals</done>
</task>

<task type="auto">
  <name>Task 4: Add test scripts to package.json</name>
  <files>package.json</files>
  <action>Add test scripts to package.json "scripts" section:

```json
"test": "vitest",
"test:ui": "vitest --ui",
"test:coverage": "vitest --coverage"
```

Scripts explained:
- `test`: Run tests in watch mode (default Vitest behavior)
- `test:ui`: Open Vitest UI for interactive test running
- `test:coverage`: Generate coverage report (requires @vitest/coverage-v8)

Do NOT add coverage provider yet (Phase 1 focuses on setup, coverage in later phases).
  </action>
  <verify>npm test runs (may show "No test files found" - this is OK for now)</verify>
  <done>Scripts added, npm test command works without errors</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm test runs without errors (OK if 0 tests found)
- [ ] npm run build succeeds
- [ ] No TypeScript errors in project
- [ ] vitest-setup.ts imports jest-dom matchers
- [ ] vite.config.ts has test config section
</verification>

<success_criteria>

- All test dependencies installed in package.json
- vite.config.ts configured for Vitest + jsdom
- vitest-setup.ts created with jest-dom import
- tsconfig.json includes Vitest types
- Test scripts added to package.json
- npm test executes successfully (0 tests is OK)
- No breaking changes to existing build/dev workflow
  </success_criteria>

<output>
After completion, create `.planning/phases/01-testing-infrastructure/01-01-SUMMARY.md`:

# Phase 1 Plan 1: Test Framework Setup Summary

**Vitest + React Testing Library configured and ready for component testing**

## Accomplishments

- Installed Vitest testing stack (6 packages)
- Configured Vitest in vite.config.ts (jsdom environment, global test utilities)
- Created vitest-setup.ts with jest-dom matchers
- Updated tsconfig.json with Vitest type definitions
- Added test scripts to package.json (test, test:ui, test:coverage)

## Files Created/Modified

- `package.json` - Added 6 devDependencies, 3 test scripts
- `vite.config.ts` - Added Vitest config section
- `vitest-setup.ts` - Created with jest-dom import
- `tsconfig.json` - Added vitest types to compilerOptions
- `package-lock.json` - Updated with new dependencies

## Decisions Made

- **Test Runner**: Vitest (Vite-native, faster than Jest for this stack)
- **DOM Environment**: jsdom (lighter than happy-dom, standard for React)
- **Globals**: Enabled (no need to import describe/it/expect)
- **Setup**: Single vitest-setup.ts file (extendable for future global test config)

## Issues Encountered

[Document any issues, or "None"]

## Next Step

Ready for Plan 01-02-PLAN.md (Write Initial Component Tests)
</output>
